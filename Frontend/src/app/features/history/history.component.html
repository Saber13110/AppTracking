<div class="history">
  <h2>Tracking History</h2>
  <ng-container *ngIf="history.length; else none">
    <ul>
      <li *ngFor="let rec of history">
        <a [routerLink]="['/track', rec.tracking_number]">{{ rec.tracking_number }}</a>
        <button (click)="togglePin(rec)" [attr.aria-label]="rec.pinned ? 'Unpin' : 'Pin'">{{ rec.pinned ? 'Unpin' : 'Pin' }}</button>
        <input [(ngModel)]="rec.note" (blur)="saveNote(rec)" placeholder="Add note" />
        <button role="button"
                tabindex="0"
                aria-label="Delete {{rec.tracking_number}} from history"
                (click)="delete(rec.id)"
                (keydown.enter)="delete(rec.id)"
                (keydown.space)="delete(rec.id)">Delete</button>
      </li>
    </ul>
    <button (click)="clear()">Delete all history</button>
    <button (click)="historyService.exportHistory('csv').subscribe(blob => download(blob, 'history.csv'))">Export CSV</button>
    <button (click)="historyService.exportHistory('pdf').subscribe(blob => download(blob, 'history.pdf'))">Export PDF</button>
  </ng-container>
  <ng-template #none>
    <p>No history yet.</p>
  </ng-template>
</div>
