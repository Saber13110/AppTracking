<div class="history">
  <h2>Tracking History</h2>

  <div class="filters">
    <input type="text" placeholder="Search" [(ngModel)]="searchTerm">
    <input type="text" placeholder="Status" [(ngModel)]="filterStatus">
    <input type="date" [(ngModel)]="filterDate">
  </div>

  <ng-container *ngIf="sortedHistory.length; else none">
    <table>
      <thead>
        <tr>
          <th>Tracking #</th>
          <th>Status</th>
          <th (click)="toggleSort()" class="sortable">
            Date
            <span *ngIf="sortAsc">&#9650;</span>
            <span *ngIf="!sortAsc">&#9660;</span>
          </th>
          <th>Note</th>
          <th>Pin</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of sortedHistory" [ngClass]="{'pinned-row': item.pinned}">
          <td><a [routerLink]="['/track', item.tracking_number]">{{item.tracking_number}}</a></td>
          <td>{{item.status || '-'}}</td>
          <td>{{item.created_at | date:'short'}}</td>
          <td>
            <input type="text"
                   [(ngModel)]="item.note"
                   (blur)="save(item)"
                   aria-label="Note for {{item.tracking_number}}">
          </td>
          <td>
            <button type="button"
                    class="pin-btn"
                    [attr.aria-pressed]="item.pinned"
                    aria-label="Toggle pin for {{item.tracking_number}}"
                    (click)="togglePin(item)">
              <span class="material-icons" [ngClass]="{'pinned': item.pinned}">push_pin</span>
            </button>
          </td>
          <td>
            <button role="button"
                    tabindex="0"
                    aria-label="Delete {{item.tracking_number}} from history"
                    (click)="delete(item.tracking_number)"
                    (keydown.enter)="delete(item.tracking_number)"
                    (keydown.space)="delete(item.tracking_number)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button role="button"
            tabindex="0"
            aria-label="Delete all tracking history"
            (click)="clear()"
            (keydown.enter)="clear()"
            (keydown.space)="clear()">Delete All</button>
    <button role="button"
            tabindex="0"
            aria-label="Export tracking history"
            (click)="export('csv')"
            (keydown.enter)="export('csv')"
            (keydown.space)="export('csv')">Export</button>
  </ng-container>
  <ng-template #none>
    <p>No history yet.</p>
  </ng-template>
</div>
